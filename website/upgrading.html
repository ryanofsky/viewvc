<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>ViewCVS: Upgrading</title>
<link rel="stylesheet" type="text/css" href="./styles.css"/>
</head>

<body>

<div id="title">
<a href="http://viewcvs.sourceforge.net/"><img 
   src="./images/title.jpg" alt="ViewCVS: Repository Browsing"/></a>
</div>

<div id="menu">
<p><a href="./index.html">Home</a> |
   <a href="http://sourceforge.net/projects/viewcvs/">Project Page</a> |
   <a href="./download.html">Download</a> |
   <a href="./upgrading.html">Upgrading</a> |
   <a href="./contributing.html">Contributing</a> |
   <a href="./license-1.html">License</a> |
   <a href="./contact.html">Contact</a> |
   <a href="./who.html">About</a>
</p>
</div>

<table id="pagetable">
<tr>
<td id="pagecolumn1">

<h4>On this page:</h4>

<ul id="bookmarks">
  <li><a href="#sec-upgrading">Upgrading Basics</a></li>
  <li><a href="#sec-from-0-9">Upgrading from 0.9</a></li>
  <li><a href="#sec-from-0-8">Upgrading from 0.8</a></li>
</ul>

<hr/>

<p align="center"><a href="http://sourceforge.net/"><img
   src="http://sourceforge.net/sflogo.php?group_id=18760&type=2"></a></p>

<address><a href="mailto:viewcvs@lyra.org">ViewCVS Users Group</a></address>

</td>
<td id="pagecolumn2">

<div class="section">

<h2 id="sec-upgrading">Upgrading Basics</h2>

<p>This document describes some of the things that you will need to 
   consider, change, or handle when upgrading an existing ViewCVS
   installation to a newer version.</p>

<p>Upgrading from an ancient version of ViewCVS to the latest version
   isn't necessarily a multi step process.  The instructions are only
   organized that way.  You can certainly upgrade in a single step.</p>

<p>It is always recommended to install the new version in a fresh
   directory and to carefully compare the configuration files.  A
   possible approach is to name the directories
   <code>/usr/local/viewcvs-0.6</code>,
   <code>/usr/local/viewcvs-0.7</code> and so on and than create a
   symbolic link <code>viewcvs</code> pointing to the production
   version.  This way you can easily test several versions and switch
   back, if your users start to complain.  </p>

</div>
<div class="section">

<h2 id="sec-from-0-9">Upgrading From 0.9</h2>

<p>This section discusses how to upgrade ViewCVS 0.9 to version 1.0 or
   a later version of the software.</p>

<h3>CGI Stubs</h3>
    
<p>The CGI stub scripts haved been moved from
   <code>&lt;VIEWCVS_INSTALLATION_DIRECTORY&gt;/cgi/</code> to
   <code>&lt;VIEWCVS_INSTALLATION_DIRECTORY&gt;/www/cgi/</code>, so
   you will need update any ScriptAlias directives pointing to them in
   your apache configuration. Also, the contents of these scripts have
   changed, so you may need to replace copies of the old scripts you
   put in other directories.</p>

<h3>Checkin Database</h3>
    
<p>ViewCVS 1.0 reads and writes commit times in the MySQL database in
   UTC time rather than local time. This can cause times displayed on
   the query page to be a few hours off if an old database is being
   used with a new version of ViewCVS.  The best way to fix this is to
   rebuild the database with the new version of cvsdbadmin, but it it
   is also possible to enable a backwards compatibility mode by
   setting <code>utc_time = 0</code> at the top of lib/dbi.py</p>

<h3>Configuration Options</h3>

<p>The following options have been added:</p>

<ul>
  <li>general/svn_roots</li>
  <li>general/root_parents</li>
  <li>general/use_rcsparse</li>
  <li>general/cvsnt_exe_path</li>
  <li>options/docroot</li>
  <li>options/http_expiration_time</li>
  <li>options/generate_etags</li>
  <li>options/root_as_url_component</li>
  <li>options/use_pagesize</li>
  <li>options/use_localtime</li>
  <li>options/cross_copies</li>
  <li>options/use_php</li>
  <li>options/php_path</li>
  <li>templates/error</li>
  <li>templates/query_form</li>
  <li>templates/query_results</li>
</ul>

<p>The following options have been removed:</p>

<ul>
  <li>options/diff_font_face</li> 
  <li>options/diff_font_size</li>
  <li>templates/footer</li>
</ul>

<h3>Templates</h3>
    
<p>The templates have changed drastically in this version of
   ViewCVS. If you are using customized templates from 0.9 or earlier,
   you will almost certainly find it easier to port your old
   customizations to the new templates than to port the old templates
   themselves. Either way, you might find it helpful to know what's
   different in the templates since 0.9, so we've listed the changes
   below.</p>

<h4>Template Arrangement</h4>
    
<p>The default templates have been rearranged a bit in ViewCVS 1.0.
   Specifically, "header.ezt" and "footer.ezt" have moved into the
   "templates/include/" subdirectory.  Also, "directory.ezt" and
   "dir_alternate.ezt" now reference new template files
   "dir_header.ezt" and "dir_footer.ezt", also found in the
   "templates/include/" subdirectory.</p>

<p>Notably, the "markup.ezt" and "annotate.ezt" templates are now
   fully self-contained.  That is, the markup and annotation data
   generated by ViewCVS is now accessible in those templates just like
   other template variables.  As a result, ViewCVS now has no more
   internal need for the <var>templates.footer</var> configuration
   variable, so that variable has been removed from the default
   configuration file.</p>

<h4>Removed Template Variables</h4>

      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>params</var>
        </dt>
        <dd>
          Replaced with new <var>search_tag_hidden_values</var>
          variable.
        </dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>rows.cvs</var>
        </dt>
        <dd>
          Replaced by <var>rows.errors</var>
        </dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>no_match</var>
        </dt>
        <dd>
          Replaced by <var>num_dead</var>
        </dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>have_logs</var> and <var>unreadable</var>
        </dt>
        <dd>Deemed unnecessary.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>sortdir_up_href</var> and <var>sortdir_down_href</var>
        </dt>
        <dd>
          Removed because <var>sortby_*_href</var> variables now set
          sort directions
        </dd>
      </dl>      
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>roots</var>
        </dt>
        <dd>
          Replaced by a different variable of the same name which is
          available to all templates (see new variables table below).
        </dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code>, <code>dir_alternate.ezt</code>,
          <code>log.ezt</code>, and <code>log_table.ezt</code>:
          <var>current_root</var>
        </dt>
        <dd>Replaced by <var>rootname</var>, which is now available to
            all templates.</dd>
      </dl>
      <dl>
        <dt><code>graph.ezt</code>: <var>request.url</var></dt>
        <dd>Replaced with new <var>imagesrc</var> variable.</dd>
      </dl>
      <dl>
        <dt><code>graph.ezt</code>: <var>request.where</var></dt>
        <dd>Replaced with <var>path</var> variable.</dd>
      </dl>      
      <dl>
        <dt><code>header.ezt</code>: <var>qquery</var></dt>
        <dd>Combined into <var>file_url</var> variable.</dd>
      </dl>
      <dl>
        <dt><code>markup.ezt</code>: <var>utc_date</var>,
        <var>href</var>, and <var>text_href</var></dt>
        <dd>
          Replaced with new <var>date_str</var>, <var>download_href</var>,
          and <var>download_text_href</var> variables.
        </dd>
      </dl>
      <dl>
        <dt><code>log.ezt</code> and <code>log_table.ezt</code>:
        <var>href</var>, <var>query</var>, <var>qquery</var>,
        <var>head_href</var>, <var>head_abs_href</var>,
        <var>entries.href</var>, and 
        <var>entries.text_href</var></dt>
        <dd>
          Replaced with new <var>entries.annotate_href</var>,
          <var>diff_url</var>, <var>diff_params</var>,
          <var>diff_select_action</var>,
          <var>branch_select_action</var>,
          <var>logsort_action</var>,
          <var>view_href</var>, <var>download_href</var>,
          <var>download_text_href</var>,
          <var>entries.download_href</var>, and
          <var>entries.download_text_href</var> variables.
        </dd>
      </dl>
      <dl>
        <dt><code>log.ezt</code> and <code>log_table.ezt</code>:
        <var>viewable</var> and <var>is_text</var></dt>
        <dd>
          Deemed unnecessary.
        </dd>
      </dl>

<h4>New Template Variables</h4>

      <dl>
        <dt>All files: <var>roottype</var>, <var>rootname</var>, and 
            <var>pathtype</var></dt>
        <dd>
          Strings denoting the type (&quot;cvs&quot; or &quot;svn&quot;)
          of the current repository, name of the current repository, 
          and type (&quot;dir&quot; or &quot;file&quot;) of the current
          path being viewed. 
        </dd>
      </dl>
      <dl>
        <dt>All files: <var>roots</var></dt>
        <dd>
          List of roots. Unlike the old <var>roots</var> variable which
          is just a list of root names, this is a list of root objects
          with name and type information accessible via <var>roots.name</var>
          and <var>roots.type</var>.
        </dd>
      </dl>
      <dl>
        <dt>All files: <var>docroot</var></dt>
        <dd>
          Web path to directory containing ViewCVS static files
          (files in <code>&lt;VIEWCVS_INSTALLATION_DIRECTORY&gt;/templates/docroot</code>)
        </dd>
      </dl>
      <dl>
        <dt><code>graph.ezt</code>: <var>imagesrc</var></dt>
        <dd>String contain URL for graph image.</dd>
      </dl>
      <dl>
        <dt><code>markup.ezt</code>: <var>date_str</var></dt>
        <dd>String representing checkin date</dd>
      </dl>
      <dl>
        <dt><code>markup.ezt</code>: <var>markup</var></dt>
        <dd>New placeholder for the marked-up file contents.</dd>
      </dl>
      <dl>
        <dt>
          <code>markup.ezt</code>:
          <var>download_href</var> and <var>download_text_href</var>
        </dt>
        <dd>New variables for links.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>tree_rev</var>, <var>tree_rev_href</var>,
          and <var>jump_rev</var>
        </dt>
        <dd>New Subversion-only directory revision items.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>rows.mime_type</var>
        </dt>
        <dd>New mime-type variable for file directory entries.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>rows.size</var>
        </dt>
        <dd>New filesize variable for file directory entries.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>rows.errors</var>
        </dt>
        <dd>List of error messages pertaining to an entry.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>up_href</var>
        </dt>
        <dd>Link to parent directory.</dd>
      </dl>
      <dl>
        <dt>
          <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:
          <var>num_dead</var>
        </dt>
        <dd>Number of dead files.</dd>
      </dl>
      <dl>
        <dt>
          <code>diff.ezt</code>: 
          <var>raw_diff</var>
        </dt>
        <dd>New variable for testing and presenting the raw
          (non-colored) diff contents.</dd>
      </dl>
      <dl>
        <dt>
          <code>annotate.ezt</code>:
          <var>lines</var>, <var>lines.line_number</var>, <var>lines.rev</var>,
          <var>lines.author</var>, <var>lines.prev_rev</var>,
          <var>lines.diff_url</var>, and <var>lines.text</var>
        </dt>
        <dd>New variables for annotations.</dd>
      </dl>
      <dl>
        <dt>
          <code>log.ezt</code> and <code>log_table.ezt</code>:
          <var>entries.filename</var>, <var>entries.size</var>,
          <var>entries.copy_path</var>, <var>entries.copy_rev</var>,
          <var>entries.copy_href</var>, <var>entries.prev_path</var>,
          and <var>entries.revision_href</var>
        </dt>
        <dd>New attributes for Subversion revisions.</dd>
      </dl>
      <dl>
        <dt>
          <code>log.ezt</code> and <code>log_table.ezt</code>:
          <var>view_href</var>, <var>download_href</var>,
          <var>download_text_href</var>,
          <var>entries.download_href</var>, and
          <var>entries.download_text_href</var>
        </dt>
        <dd>New variables for links.</dd>
      </dl>

<h4>New Template Form Variables</h4>

<p>Each HTML form that appears in ViewCVS templates is now associated
   with 2 new variables which should be used to determine its
   <code>ACTION</code> value and its hidden field values.  Forms using
   the new variables look like:</p>

<pre>
&lt;form method=get action="[my_form_action]"&gt;
  [my_form_hidden_values]
   ... form widgets go here ...
&lt;/form&gt;
</pre>

<p>Here is a list of the new variable names and the forms they are
   associated with:</p>

    <table border=1>
      <tr>
        <th>Variables</th><th>Form</th>
      </tr>
      <tr>
        <td>
          <var>change_root_action</var><br>
          <var>change_root_hidden_values</var>
        </td>
        <td>
          Root selector form in <code>directory.ezt</code> and
          <code>dir_alternate.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>jump_rev_action</var><br>
          <var>jump_rev_hidden_values</var>
        </td>
        <td>
          Subversion directory revision selector form in
          <code>directory.ezt</code> and
          <code>dir_alternate.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>dir_paging_action</var><br>
          <var>dir_paging_hidden_values</var>
        </td>
        <td>
          Directory paging form in <code>directory.ezt</code> and
          <code>dir_alternate.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>search_tag_action</var><br>
          <var>search_tag_hidden_values</var>
        </td>
        <td>
           Tag choosing and regular expression searching form in
           <code>directory.ezt</code> and
           <code>dir_alternate.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>log_paging_action</var><br>
          <var>log_paging_hidden_values</var>
        </td>
        <td>
           Log page paging form in <code>include/paging.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>diff_select_action</var><br>
          <var>diff_select_hidden_values</var>
        </td>
        <td>
           Arbitrary diff form on log page in
           <code>include/diff_form.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>branch_select_action</var><br>
          <var>branch_select_hidden_values</var>
        </td>
        <td>
           Branch select form on log page in
           <code>include/branch_form.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>logsort_action</var><br>
          <var>logsort_hidden_values</var>
        </td>
        <td>
           Log sort form on log page in <code>include/sort.ezt</code>.
        </td>
      </tr>
      <tr>
        <td>
          <var>diff_format_action</var><br>
          <var>diff_format_hidden_values</var>
        </td>
        <td>
           Diff format form in <code>include/diff.ezt</code>.
        </td>
      </tr>
    </table>

<h4>Other Template Changes</h4>

<p>In <code>directory.ezt</code> and <code>dir_alternate.ezt</code>:</p>

    <ul>
      <li>
        A new form for changing the current directory revision is 
        displayed for subversion directories.
      </li>
      <li>
        A new form that controls paging is displayed when 
        cfg.options.use_pagesize is not 0
      </li>
      <li>
        The sorting links and "hide attic" link are no longer 
        prefixed with "<code>./</code>"
      </li>
      <li>
        The revision number links no longer need 
        "<code>content-type=text/vnd.viewcvs-markup</code>" suffixes.
      </li>
      <li>
        The link to Attic/ is only displayed for CVS roots
      </li>
      <li>
        Directory <var>rows.name</var> values no longer have
        trailing slashes
      </li>
    </ul>

<p>In <code>log.ezt</code> and <code>log_table.ezt</code>:</p>

    <ul>
      <li>
        "Default branch" section moved into include/branch.ezt and is
        only displayed for CVS roots
      </li>
      <li>
        "Current tag" section moved into include/view_tag.ezt and is
        only displayed for CVS roots
      </li>
      <li>
        "Changes since" is only displayed for cvs roots
      </li>
      <li>
        New paging form is included from include/paging.ezt
      </li>
      <li>
        Arbitrary diff form moved into include/diff_form.ezt
      </li>
      <li>
        Branch select form moved into include/branch_form.ezt
      </li>
      <li>
        Log sort form moved into include/sort.ezt
      </li>
    </ul>

</div>
<div class="section">

<h2 id="sec-from-0-8">Upgrading From 0.8</h2>

    <p>
      This section discusses how to upgrade ViewCVS 0.8 to version
      0.9 or a later version of the software.
    </p>
    
    <p>
      <strong>NOTE:</strong> these changes will bring you up to the
      requirements of version 0.9. You must also follow the directions
      for <a href="#from9">upgrading from 0.9</a>.
    </p>

    <h3>Configuration Options</h3>
    <p>
      More templates were introduced in version 0.8 of the software,
      which made many of the configuration options obsolete. This
      section covers which options were removed. If you made any
      changes to these options, then you will need to make
      corresponding changes in the templates.
    </p>

      <dl>
	<dt>
	  Colors:
	  <strong>diff_heading</strong>,
	  <strong>diff_empty</strong>,
	  <strong>diff_remove</strong>,
	  <strong>diff_change</strong>,
	  <strong>diff_add</strong>,
	  and <strong>diff_dark_change</strong>
	</dt>
	<dd>
	  These options have been incorporated into the
	  <code>diff.ezt</code> template.

	  <p></p>
	</dd>

	<dt><strong>markup_log</strong></dt>
	<dd>
	  This option has been incorporated into the
	  <code>markup.ezt</code> template.

	  <p></p>
	</dd>

        <dt>Colors: <strong>nav_header</strong>
          and <strong>alt_background</strong></dt>
	<dd>
	  These options have been incorporated into the
	  <code>header.ezt</code> template.

	  <p></p>
	</dd>

        <dt>
	  Images:
          <strong>back_icon</strong>,
          <strong>dir_icon</strong>,
          and <strong>file_icon</strong>
        </dt>
	<dd>
	  These options have been incorporated into the
	  <code>directory.ezt</code>, <code>header.ezt</code>,
	  <code>log.ezt</code>, <code>log_table.ezt</code>, and
	  <code>query.ezt</code> templates.

	  <p></p>
	</dd>

	<dt><strong>use_java_script</strong>
          and <strong>open_extern_window</strong></dt>
	<dd>
	  The templates now use JavaScript in all applicable places,
	  and open external windows for most downloading and viewing
	  of files. If you wish to not use JavaScript and/or external
	  windows, then remove the feature(s) from the templates.

	  <p></p>
	</dd>

	<dt><strong>show_author</strong></dt>
	<dd>
          Changing this option would be quite strange and rare. If you
          do not want to show the author for the revisions, then you
          should remove it from the various templates.

	  <p></p>
	</dd>

	<dt><strong>hide_non_readable</strong></dt>
	<dd>
          This option was never used, so it has been removed.

	  <p></p>
	</dd>

	<dt><strong>flip_links_in_dirview</strong></dt>
	<dd>
          This option is no longer available. If you want the links in
          your directory view flipped, then you may use the
          <code>dir_alternate.ezt</code> template.

	  <p></p>
	</dd>

      </dl>

    <h3>Template Variables</h3>
    <p>
      Some template variables that were available in 0.8 have been
      removed in 0.9. If you have custom templates that refer to these
      variables, then you will need to modify your templates.
    </p>

	    <dl>
	      <dt><code>directory.ezt</code>: <var>headers</var></dt>
	      <dd>
		The headers are now listed explicitly in the template,
		rather than made available through a list.
		<p></p>
	      </dd>

	      <dt>
		<code>directory.ezt</code>:
		<var>rows.cols</var>,
		and <var>rows.span</var>
	      </dt>
	      <dd>
		These variables were used in conjunction with the
		<var>headers</var> variable to control the column
		displays. This is now controlled explicitly within the
		templates.
		<p></p>
	      </dd>

	      <dt><code>directory.ezt</code>:
		<var>rev_in_front</var></dt>
	      <dd>
		This was used to indicate that revision links should
		be used in the first column, rather than in their
		standard place in the second column. Changing the
		links should now be done in the template, rather than
		according to this variable. You may want to look at
		the <code>dir_alternate.ezt</code> template, which has
		the revision in front.
		<p></p>
	      </dd>

	      <dt><code>directory.ezt</code>:
		<var>rows.attic</var>
		and <var>rows.hide_attic_href</var></dt>
	      <dd>
		These variable were used to manage the hide and
		showing of the contents of the <code>Attic/</code>
		subdirectory. Several new variables were introduced
		which can be used to replace this functionality:
		<var>show_attic_href</var>,
		<var>hide_attic_href</var>, and <var>rows.state</var>.
		<p></p>
	      </dd>
	    </dl>

</div>

</td>
</tr>
</table>
</body>
</html>
